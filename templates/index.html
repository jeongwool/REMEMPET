<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REMEMPET - ë‚˜ì˜ ê·¸ë¦¬ìš´ ê°•ì•„ì§€</title>
    <style>
body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: #fef9f6; color: #4F4A45; margin: 0; padding: 2rem; }
nav { display: flex; justify-content: space-between; align-items: center; background: white; padding: 1rem 2rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
nav h2 { margin: 0; color: #F79489; }
nav a { color: #F79489; text-decoration: none; font-weight: 500; }
.container { display: flex; flex-wrap: wrap; gap: 2rem; margin-top: 2rem; }
.sidebar { flex: 1; min-width: 300px; background: white; padding: 2.5rem; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
.main-content { flex: 2; min-width: 300px; background: white; padding: 2.5rem; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
input { display: block; width: 100%; padding: 0.8rem; margin-bottom: 1rem; border: 1px solid #eee; border-radius: 8px; box-sizing: border-box; font-size: 1rem; background: #fdfdfd; }
label { font-weight: bold; margin-bottom: 0.5rem; display: block; color: #555; }
button { width: 100%; padding: 0.8rem; background-color: #F79489; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: bold; }
button:hover { background-color: #f57d72; }
button:disabled { background-color: #fcdad6; }

.pet-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1rem;
}

.pet-item {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: #fdf0ee;
    border-radius: 16px;
    padding: 0.8rem 1.2rem;
    min-height: 55px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.04);
}

.pet-item a {
    text-decoration: none;
    color: #F79489;
    font-weight: bold;
    font-size: 1.05rem;
    flex-grow: 1;
}

.pet-item .delete-btn {
    background: none;
    border: none;
    color: #F79489;
    cursor: pointer;
    font-size: 1.4rem;
    margin-left: 10px;
    margin-right: -5px;
}

.pet-item .delete-btn:hover {
    color: #d65f55;
    transform: scale(1.2);
}

/* â¬‡ï¸ ëŒ€í™”í•˜ëŸ¬ê°€ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
#generated-pet {
    text-align: center;
    display: none;
    margin-top: 2.5rem;
}

#go-to-chat {
    display: none;
    margin-top: 1.4rem;
    padding: 1rem 1.5rem;
    background-color: #F79489;
    color: white;
    border-radius: 10px;
    text-decoration: none;
    font-size: 1.2rem;
    font-weight: bold;
}
#go-to-chat:hover {
    background-color: #f57d72;
}
    </style>
</head>
<body>
    <nav>
        <h2>ğŸ¾ REMEMPET: ë‚˜ì˜ ë°˜ë ¤ê²¬ ğŸ¾</h2>
        <div><strong>{{ current_user.username }}</strong>ë‹˜ <a href="{{ url_for('logout') }}">ë¡œê·¸ì•„ì›ƒ</a></div>
    </nav>

    <div class="container">
        <aside class="sidebar">
            <h3>â¤ï¸ ê°•ì•„ì§€ ë– ì˜¬ë¦¬ê¸° â¤ï¸</h3>
            <label>ì´ë¦„:</label><input type="text" id="name_input">
            <label>ì¢…:</label>
            <input list="breeds" id="breed_input" placeholder="ëª©ë¡ì—ì„œ ì„ íƒí•˜ê±°ë‚˜ ì§ì ‘ ì…ë ¥">
            <datalist id="breeds">
                <option value="ê³¨ë“  ë¦¬íŠ¸ë¦¬ë²„"></option>
                <option value="í¬ë©”ë¼ë‹ˆì•ˆ"></option>
                <option value="í‘¸ë“¤"></option>
                <option value="ì¹˜ì™€ì™€"></option>
                <option value="ë‹¥ìŠ¤í›ˆíŠ¸"></option>
                <option value="ì‹œë°”ê²¬"></option>
                <option value="ë§í‹°ì¦ˆ"></option>
                <option value="ì§„ë—ê°œ"></option>
                <option value="ì‹œì¸„"></option>
                <option value="ìš”í¬ì…” í…Œë¦¬ì–´"></option>
            </datalist>
            <label>ìƒ‰ê¹”:</label><input type="text" id="color_input">
            <label>ë‚˜ì´:</label><input type="text" id="age_input" placeholder="ex) ~ì‚´">
            <label>ì¢‹ì•„í–ˆë˜ ìŒì‹:</label><input type="text" id="food_input" placeholder="ex) êµ¬ìš´ ë‹­ê°€ìŠ´ì‚´">
            <label>ê°€ê³  ì‹¶ì€ ê³³:</label><input type="text" id="background_input" placeholder="ex) ê³µì›, í”„ë‘ìŠ¤">
            <button id="create_btn">ì§„í–‰í•˜ê¸°</button>
        </aside>

        <main class="main-content">
            <h3>ğŸ¾ ë‚˜ì˜ ì†Œì¤‘í•œ ë³„ë“¤</h3>
            <div class="pet-list" id="pet-list-container">
                {% for pet in pets %}
                <div class="pet-item" data-pet-id="{{ pet.id }}">
                    <a href="{{ url_for('chat_page', pet_id=pet.id) }}">ğŸ¶ {{ pet.name }} ({{ pet.breed }})</a>
                    <button class="delete-btn">Ã—</button>
                </div>
                {% endfor %}
            </div>

            <div id="generated-pet">
                <h3>âœ¨ ì•Œë¦¼ âœ¨</h3>
                <p id="pet_description"></p>
                <a id="go-to-chat" href="#">ê°•ì•„ì§€ë‘ ë†€ëŸ¬ê°€ê¸°</a>
            </div>
        </main>
    </div>

    <script>
        document.getElementById('create_btn').addEventListener('click', async () => {
            const btn = document.getElementById('create_btn');
            const gen = document.getElementById('generated-pet');
            const desc = document.getElementById('pet_description');
            const link = document.getElementById('go-to-chat');

            btn.disabled = true;
            btn.innerText = 'ìƒê° ì¤‘...';
            gen.style.display = 'block';
            desc.innerText = 'ğŸŒŸ ì²œêµ­ì—ì„œ ê°•ì•„ì§€ê°€ ë‚´ë ¤ì˜¤ê³  ìˆì–´ìš”... ì ì‹œë§Œìš”!';
            link.style.display = 'none';

            const data = {
                name: document.getElementById('name_input').value,
                breed: document.getElementById('breed_input').value,
                color: document.getElementById('color_input').value,
                age: document.getElementById('age_input').value,
                favorite_food: document.getElementById('food_input').value,
                background: document.getElementById('background_input').value
            };

            try {
                const res = await fetch('/api/create_pet', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await res.json();

                if (result.success) {
                    desc.innerText = 'âœ¨ ê°•ì•„ì§€ê°€ ë„ì°©í–ˆì–´ìš”! ëŒ€í™”ë¥¼ ì‹œì‘í•´ë³¼ê¹Œìš”?';
                    link.href = `/chat/${result.pet_id}`;
                    link.style.display = 'inline-block';
                } else {
                    desc.innerText = `âš ï¸ ì‹¤íŒ¨: ${result.error}`;
                }
            } catch (e) {
                desc.innerText = `âš ï¸ ì˜¤ë¥˜: ${e}`;
            }

            btn.disabled = false;
            btn.innerText = 'ê°•ì•„ì§€ ë– ì˜¬ë¦¬ê¸°';
        });

        document.getElementById('pet-list-container').addEventListener('click', async (e) => {
            if (e.target.classList.contains('delete-btn')) {
                const item = e.target.closest('.pet-item');
                if (confirm('ì •ë§ ì‚­ì œí• ê¹Œìš”?')) {
                    const res = await fetch(`/api/delete_pet/${item.dataset.petId}`, { method: 'POST' });
                    if ((await res.json()).success) item.remove();
                }
            }
        });
    </script>
</body>
</html>
