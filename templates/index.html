<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REMEMPET - ê°•ì•„ì§€ ë§Œë“¤ê¸°</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: #fef9f6; color: #4F4A45; margin: 0; padding: 2rem; }
        nav { display: flex; justify-content: space-between; align-items: center; background: white; padding: 1rem 2rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        nav h2 { margin: 0; color: #F79489; }
        nav a { color: #F79489; text-decoration: none; font-weight: 500; }
        .container { display: flex; flex-wrap: wrap; gap: 2rem; margin-top: 2rem; }
        .sidebar { flex: 1; min-width: 300px; background: white; padding: 2.5rem; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .main-content { flex: 2; min-width: 300px; background: white; padding: 2.5rem; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        
        input { display: block; width: 100%; padding: 0.8rem; margin-bottom: 1rem; border: 1px solid #eee; border-radius: 8px; box-sizing: border-box; font-size: 1rem; background: #fdfdfd; }
        label { font-weight: bold; margin-bottom: 0.5rem; display: block; color: #555; }
        
        button { width: 100%; padding: 0.8rem; background-color: #F79489; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: bold; }
        button:hover { background-color: #f57d72; }
        button:disabled { background-color: #fcdad6; }
        
        .pet-list { display: flex; flex-direction: column; gap: 0.75rem; }
        .pet-item { display: flex; justify-content: space-between; align-items: center; background: #fdf0ee; border-radius: 20px; padding: 0.5rem 1rem; }
        .pet-item a { text-decoration: none; color: #F79489; font-weight: bold; flex-grow: 1; }
        .delete-btn { background: none; border: none; color: #F79489; cursor: pointer; font-size: 1.2rem; padding: 0 0.5rem; }
        
        #generated-pet { text-align: center; display: none; margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #eee; }
        #pet_description { color: #333; font-size: 1.2rem; font-weight: bold; margin-bottom: 1.5rem; }
        #go-to-chat { display: inline-block; width: 100%; padding: 1rem; background-color: #F79489; color: white; border-radius: 8px; text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>
    <nav>
        <h2>ğŸ¾ REMEMPET: ë‚˜ì˜ ë°˜ë ¤ê²¬ ê¸°ì–µ ğŸ¾</h2>
        <div><strong>{{ current_user.username }}</strong>ë‹˜ <a href="{{ url_for('logout') }}">ë¡œê·¸ì•„ì›ƒ</a></div>
    </nav>
    
    <div class="container">
        <aside class="sidebar">
            <h3>â¤ï¸ ê¸°ì–µ ë§Œë“¤ê¸° â¤ï¸</h3>
            <label>ì´ë¦„: <span style="color:red">*</span></label> 
            <input type="text" id="name_input" placeholder="ì´ˆì½”">
            
            <label>ì¢…: <span style="color:red">*</span></label>
            <input list="breeds" id="breed_input" placeholder="ëª©ë¡ì—ì„œ ì„ íƒí•˜ê±°ë‚˜ ì§ì ‘ ì…ë ¥">
            <datalist id="breeds">
                <option value="ê³¨ë“  ë¦¬íŠ¸ë¦¬ë²„"></option>
                <option value="í¬ë©”ë¼ë‹ˆì•ˆ"></option>
                <option value="í‘¸ë“¤"></option>
                <option value="ì¹˜ì™€ì™€"></option>
                <option value="ë‹¥ìŠ¤í›ˆíŠ¸"></option>
                <option value="ì‹œë°”ê²¬"></option>
                <option value="ë§í‹°ì¦ˆ"></option>
                <option value="ì§„ë—ê°œ"></option>
                <option value="ì‹œì¸„"></option>
                <option value="ìš”í¬ì…” í…Œë¦¬ì–´"></option>
            </datalist>
            
            <label>ìƒ‰ê¹”: <span style="color:red">*</span></label> 
            <input type="text" id="color_input" placeholder="í•˜ì–€ìƒ‰">
            
            <label>ë‚˜ì´: <span style="color:red">*</span></label> 
            <input type="text" id="age_input" placeholder="15ì‚´">
            
            <label>ì¢‹ì•„í–ˆë˜ ìŒì‹:</label> <input type="text" id="food_input" placeholder="ë‹­ê°€ìŠ´ì‚´">
            <label>ê°€ê³  ì‹¶ì€ ê³³:</label> <input type="text" id="background_input" placeholder="ê³µì›">
            
            <button id="create_btn">ê°•ì•„ì§€ ë§Œë“¤ê¸°</button>
        </aside>

        <main class="main-content">
            <h3>ğŸ¾ ë‚˜ì˜ ê°•ì•„ì§€ ëª©ë¡</h3>
            <div class="pet-list" id="pet-list-container">
                {% for pet in pets %}
                    <div class="pet-item" data-pet-id="{{ pet.id }}">
                        <a href="{{ url_for('chat_page', pet_id=pet.id) }}">ğŸ¶ {{ pet.name }} ({{ pet.breed }})</a>
                        <button class="delete-btn">Ã—</button>
                    </div>
                {% endfor %}
            </div>

            <div id="generated-pet">
                <h3>âœ¨ ì•Œë¦¼ âœ¨</h3>
                <p id="pet_description"></p>
                <a id="go-to-chat" href="#">ëŒ€í™”í•˜ëŸ¬ ê°€ê¸°</a>
            </div>
        </main>
    </div>

    <script>
        document.getElementById('create_btn').addEventListener('click', async () => {
            const createBtn = document.getElementById('create_btn');
            
            // [ìˆ˜ì •] ê°’ì„ ë¨¼ì € ê°€ì ¸ì˜µë‹ˆë‹¤.
            const name = document.getElementById('name_input').value.trim();
            const breed = document.getElementById('breed_input').value.trim();
            const color = document.getElementById('color_input').value.trim();
            const age = document.getElementById('age_input').value.trim();
            const food = document.getElementById('food_input').value.trim();
            const bg = document.getElementById('background_input').value.trim();

            // [ì¶”ê°€] í•„ìˆ˜ê°’ ê²€ì¦ ë¡œì§
            if (!name || !breed || !color || !age) {
                alert("âš ï¸ í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!\n(ì´ë¦„, ì¢…, ìƒ‰ê¹”, ë‚˜ì´ëŠ” ê¼­ í•„ìš”í•´ìš”)");
                return; // í•¨ìˆ˜ë¥¼ ì—¬ê¸°ì„œ ê°•ì œë¡œ ì¢…ë£Œí•©ë‹ˆë‹¤ (ì„œë²„ë¡œ ì „ì†¡ ì•ˆ í•¨)
            }

            const genDiv = document.getElementById('generated-pet');
            const petDesc = document.getElementById('pet_description');
            const chatLink = document.getElementById('go-to-chat');

            createBtn.disabled = true;
            createBtn.innerText = 'ìƒì„± ì¤‘...';
            
            genDiv.style.display = 'block';
            petDesc.innerText = 'AIê°€ ê°•ì•„ì§€ì˜ ê¸°ì–µì„ ì—°ê²°í•˜ê³  ìˆìŠµë‹ˆë‹¤...';
            chatLink.style.display = 'none';

            const data = {
                name: name,
                breed: breed,
                color: color,
                age: age,
                favorite_food: food,
                background: bg
            };

            try {
                const response = await fetch('/api/create_pet', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                
                if (result.success) {
                    petDesc.innerText = 'ìƒì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ì´ì œ ê°•ì•„ì§€ì™€ ëŒ€í™”í•´ë³´ì„¸ìš”.';
                    chatLink.href = `/chat/${result.pet_id}`;
                    chatLink.style.display = 'inline-block';
                    
                    // ëª©ë¡ ì¶”ê°€
                    const list = document.getElementById('pet-list-container');
                    const div = document.createElement('div');
                    div.className = 'pet-item';
                    div.setAttribute('data-pet-id', result.pet_id);
                    div.innerHTML = `<a href="/chat/${result.pet_id}">ğŸ¶ ${result.pet_name} (${data.breed})</a><button class="delete-btn">Ã—</button>`;
                    list.appendChild(div);
                } else {
                    petDesc.innerText = `âš ï¸ ì‹¤íŒ¨: ${result.error}`;
                }
            } catch (e) { petDesc.innerText = `âš ï¸ ì˜¤ë¥˜: ${e}`; }
            
            createBtn.disabled = false;
            createBtn.innerText = 'ê°•ì•„ì§€ ë§Œë“¤ê¸°';
        });

        // ì‚­ì œ ê¸°ëŠ¥
        document.getElementById('pet-list-container').addEventListener('click', async (e) => {
            if (e.target.classList.contains('delete-btn')) {
                const item = e.target.closest('.pet-item');
                if (confirm('ì •ë§ ì‚­ì œí• ê¹Œìš”?')) {
                    const res = await fetch(`/api/delete_pet/${item.dataset.petId}`, { method: 'POST' });
                    if ((await res.json()).success) item.remove();
                }
            }
        });
    </script>
</body>
</html>